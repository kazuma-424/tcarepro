<br>
<br>
<br>
<br>

<!--<table class="header-table space" width="90%">
  <tr>
    <th colspan="10">ステータス別結果</th>
  </tr>
  <tr>
    <th></th>
    <th>着信留守</th>
    <th>担当者不在</th>
    <th>見込</th>
    <th>コロナ見込</th>
    <th>折返待</th>
    <th>APP</th>
    <th>キャンセル</th>
    <th>フロントNG</th>
    <th>根本的NG</th>
    <th>永久NG</th>
  </tr>
  <tr>
    <!% @users.each do |user| %>
    <th><!%= user.user_name %></th>
    <td><!%= user.calls.where(statu: "着信留守").count %></td>
    <td><!%= user.calls.where(statu: "担当者不在").count %></td>
    <td><!%= user.calls.where(statu: "見込").count %></td>
    <td><!%= user.calls.where(statu: "コロナ見込").count %></td>
    <td><!%= user.calls.where(statu: "折返待").count %></td>
    <td><!%= user.calls.where(statu: "APP").count %></td>
    <td><!%= user.calls.where(statu: "キャンセル").count %></td>
    <td><!%= user.calls.where(statu: "フロントNG").count %></td>
    <td><!%= user.calls.where(statu: "根本的NG").count %></td>
    <td><!%= user.calls.where(statu: "永久NG").count %></td>
  </tr>
  <tr>
    <th></th>
    <td><!%= number_to_percentage(user.calls.where(statu: "着信留守").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
    <td><!%= number_to_percentage(user.calls.where(statu: "担当者不在").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
    <td><!%= number_to_percentage(user.calls.where(statu: "見込").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
    <td><!%= number_to_percentage(user.calls.where(statu: "コロナ見込").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
    <td><!%= number_to_percentage(user.calls.where(statu: "折返待").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
    <td><!%= number_to_percentage(user.calls.where(statu: "APP").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
    <td><!%= number_to_percentage(user.calls.where(statu: "キャンセル").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
    <td><!%= number_to_percentage(user.calls.where(statu: "フロントNG").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
    <td><!%= number_to_percentage(user.calls.where(statu: "根本的NG").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
    <td><!%= number_to_percentage(user.calls.where(statu: "永久NG").count / @call_count.count.to_f * 100, precision: 1 ) %></td>
  </tr>
<!% end %>
</table>-->

<table class="header-table space" width="90%">
  <tr>
    <th colspan="6">１日のコール状況</th>
  </tr>
  <tr>
    <th></th>
    <th>コール数</th>
    <th>見込獲得数</th>
    <th>アポ数</th>
    <th>見込獲得数</th>
    <th>アポ獲得率</th>
  </tr>
  <tr>
    <th>1日のコール状況</th>
    <td><%= @call_count_today %>Call</td>
    <td><%= @protect_count_today %>件</td>
    <td><%= @app_count_today %>件</td>
    <td><%= @protect_convertion_today.ceil(2) %>%</td>
    <td><%= @app_convertion_today.ceil(2) %>%</td>
  </tr>
  <tr>
    <th>1週間のコール状況</th>
    <td><%= @call_count_week %>Call</td>
    <td><%= @protect_count_week %>件</td>
    <td><%= @app_count_week %>件</td>
    <td><%= @protect_convertion_week.ceil(2) %>%</td>
    <td><%= @app_convertion_week.ceil(2) %>%</td>
  </tr>
  <tr>
    <th>1ヶ月のコール状況</th>
    <td><%= @call_count_month %>Call</td>
    <td><%= @protect_count_month %>件</td>
    <td><%= @app_count_month %>件</td>
    <td><%= @protect_convertion_month.ceil(2) %>%</td>
    <td><%= @app_convertion_month.ceil(2) %>%</td>
  </tr>
</table>
<br>
<br>
<br>
<br>
<table class="header-table space" width="90%">
  <tr>
    <th colspan="10">ステータス別結果</th>
  </tr>
  <tr>
    <th>着信留守</th>
    <th>担当者不在</th>
    <th>見込</th>
    <th>APP</th>
    <th>キャンセル</th>
    <th>NG</th>
  </tr>
  <tr>
    <td><%= @call_count_called.count %></td>
    <td><%= @call_count_absence.count %></td>
    <td><%= @call_count_prospect.count %></td>
    <td><%= @call_count_app.count %></td>
    <td><%= @call_count_cancel.count %></td>
    <td><%= @call_count_ng.count %></td>
  </tr>
  <tr>
    <td><%= number_to_percentage(@call_count_called.count / @call_count_month.to_f * 100, precision: 1 ) %></td>
    <td><%= number_to_percentage(@call_count_absence.count / @call_count_month.to_f * 100, precision: 1 ) %></td>
    <td><%= number_to_percentage(@call_count_prospect.count / @call_count_month.to_f * 100, precision: 1 ) %></td>
    <td><%= number_to_percentage(@call_count_app.count / @call_count_month.to_f * 100, precision: 1 ) %></td>
    <td><%= number_to_percentage(@call_count_cancel.count / @call_count_month.to_f * 100, precision: 1 ) %></td>
    <td><%= number_to_percentage(@call_count_ng.count / @call_count_month.to_f * 100, precision: 1 ) %></td>
  </tr>
</table>
<br>
<br>
<br>
<br>
<table class="header-table space" width="90%">
  <tr>
    <th colspan="6">企業別アポ状況</th>
  </tr>
  <tr>
    <th>企業名</th>
    <th>コール数</th>
    <th>アポ数</th>
    <th>アポ率</th>
    <th>残アポ数</th>
  </tr>
  <tr>
    <% @detailCount = @detailcalls.where("industry LIKE ?", "%SORAIRO%").where("calls.created_at > ?", Time.current.beginning_of_month).where("calls.created_at < ?", Time.current.end_of_month).count %>
    <% @detailAppCount = @detailcalls.where("industry LIKE ?", "%SORAIRO%").where("calls.statu": "APP").where("calls.created_at > ?", Time.current.beginning_of_month).where("calls.created_at < ?", Time.current.end_of_month).count %>
    <% @detailRemainCount = (@detailAppCount > 30) ? 0 : 30 - @detailAppCount %>
    <th>SORAIRO</th>
    <td><%= @detailCount %></td>
    <td><%= @detailAppCount %></td>
    <td><%= number_to_percentage(@detailCount <= 0 ? 0 : @detailAppCount * 100.0 / @detailCount, precision: 1 ) %></td>
    <td><%= @detailRemainCount %></td>
  </tr>
  <tr>
    <% @detailCount = @detailcalls.where("industry LIKE ?", "%JAIC池袋%").where("calls.created_at > ?", Time.current.beginning_of_month).where("calls.created_at < ?", Time.current.end_of_month).count %>
    <% @detailAppCount = @detailcalls.where("industry LIKE ?", "%JAIC池袋%").where("calls.statu": "APP").where("calls.created_at > ?", Time.current.beginning_of_month).where("calls.created_at < ?", Time.current.end_of_month).count %>
    <% @detailRemainCount = (@detailAppCount > 20) ? 0 : 20 - @detailAppCount %>
    <th>JAIC池袋</th>
    <td><%= @detailCount %></td>
    <td><%= @detailAppCount %></td>
    <td><%= number_to_percentage(@detailCount <= 0 ? 0 : @detailAppCount * 100.0 / @detailCount, precision: 1 ) %></td>
    <td><%= @detailRemainCount %></td>
  </tr>
  <tr>
    <% @detailCount = @detailcalls.where("industry LIKE ?", "%アポ匠%").where("calls.created_at > ?", Time.current.beginning_of_month).where("calls.created_at < ?", Time.current.end_of_month).count %>
    <% @detailAppCount = @detailcalls.where("industry LIKE ?", "%アポ匠%").where("calls.statu": "APP").where("calls.created_at > ?", Time.current.beginning_of_month).where("calls.created_at < ?", Time.current.end_of_month).count %>
    <% @detailRemainCount = (@detailAppCount > 50) ? 0 : 20 - @detailAppCount %>
    <th>アポ匠</th>
    <td><%= @detailCount %></td>
    <td><%= @detailAppCount %></td>
    <td><%= number_to_percentage(@detailCount <= 0 ? 0 : @detailAppCount * 100.0 / @detailCount, precision: 1 ) %></td>
    <td><%= @detailRemainCount %></td>
  </tr>
  <tr>
  </tr>
</table>
<br>
<br>
<br>
<br>
<table class="header-table space" width="90%">
  <tr>
    <th colspan="7">スタッフ別コール</th>
  </tr>
  <tr>
    <th>スタッフ名</th>
    <th>コール数</th>
    <th>月間コール数</th>
    <th>見込数</th>
    <th>APP数</th>
    <th>キャンセル数</th>
    <th>APP率</th>
  </tr>
  <% @users.each do |user| %>
  <tr>
    <td><%= user.user_name %></td>
    <td><%= user.calls.where('created_at > ?', Time.current.beginning_of_day).where('created_at < ?', Time.current.end_of_day).count %></td>
    <td><%= user.calls.where('created_at > ?', Time.current.beginning_of_month).where('created_at < ?', Time.current.end_of_month).count  %></td>
    <td><%= user.calls.where(statu: "見込").where('created_at > ?', Time.current.beginning_of_month).where('created_at < ?', Time.current.end_of_month).count %></td>
    <td><%= user.calls.where(statu: "APP").where('created_at > ?', Time.current.beginning_of_month).where('created_at < ?', Time.current.end_of_month).count %></td>
    <td><%= user.calls.where(statu: "キャンセル").where('created_at > ?', Time.current.beginning_of_month).where('created_at < ?', Time.current.end_of_month).count %></td>
    <td><%= number_to_percentage(user.calls.where(statu: "APP").where('created_at > ?', Time.current.beginning_of_month).where('created_at < ?', Time.current.end_of_month).count.to_f / user.calls.where('created_at > ?', Time.current.beginning_of_month).where('created_at < ?', Time.current.end_of_month).count.to_f * 100, precision: 1) %></td>
  </tr>
  <%end%>
</table>
<br>
<br>
<br>
<br>
<table class="header-table space" width="90%">
  <tr>
    <th colspan="6">時間別コール</th>
  </tr>
  <tr>
    <th></th>
    <th>不在率</th>
    <th>担当不在率</th>
    <th>見込率</th>
    <th>APP率</th>
    <th>NG率</th>
  </tr>
  <tr>
    <th>09:00~10:00</th>
    <td><%= number_to_percentage(@call_called_9 / @call_total_9.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_called_b9 / @call_total_b9.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_absence_9 / @call_total_9.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_absence_b9 / @call_total_b9.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_prospect_9 / @call_total_9.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_prospect_b9 / @call_total_b9.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_app_9 / @call_total_9.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_app_b9 / @call_total_b9.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_ng_9 / @call_total_9.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_ng_b9 / @call_total_b9.to_f * 100, precision: 1) %>）</td>
  </tr>
  <tr>
    <th>10:00~11:00</th>
    <td><%= number_to_percentage(@call_called_10 / @call_total_10.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_called_b10 / @call_total_b10.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_absence_10 / @call_total_10.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_absence_b10 / @call_total_b10.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_prospect_10 / @call_total_10.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_prospect_b10 / @call_total_b10.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_app_10 / @call_total_10.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_app_b10 / @call_total_b10.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_ng_10 / @call_total_10.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_ng_b10 / @call_total_b10.to_f * 100, precision: 1) %>）</td>
  </tr>
  <tr>
    <th>11:00~12:00</th>
    <td><%= number_to_percentage(@call_called_11 / @call_total_11.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_called_b11 / @call_total_b11.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_absence_11 / @call_total_11.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_absence_b11 / @call_total_b11.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_prospect_11 / @call_total_11.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_prospect_b11 / @call_total_b11.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_app_11 / @call_total_11.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_app_b11 / @call_total_b11.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_ng_11 / @call_total_11.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_ng_b11 / @call_total_b11.to_f * 100, precision: 1) %>）</td>
  </tr>
  <tr>
    <th>13:00~14:00</th>
    <td><%= number_to_percentage(@call_called_13 / @call_total_13.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_called_b13 / @call_total_b13.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_absence_13 / @call_total_13.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_absence_b13 / @call_total_b13.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_prospect_13 / @call_total_13.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_prospect_b13 / @call_total_b13.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_app_13 / @call_total_13.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_app_b13 / @call_total_b13.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_ng_13 / @call_total_13.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_ng_b13 / @call_total_b13.to_f * 100, precision: 1) %>）</td>
  </tr>
  <tr>
    <th>14:00~15:00</th>
    <td><%= number_to_percentage(@call_called_14 / @call_total_14.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_called_b14 / @call_total_b14.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_absence_14 / @call_total_14.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_absence_b14 / @call_total_b14.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_prospect_14 / @call_total_14.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_prospect_b14 / @call_total_b14.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_app_14 / @call_total_14.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_app_b14 / @call_total_b14.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_ng_14 / @call_total_14.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_ng_b14 / @call_total_b14.to_f * 100, precision: 1) %>）</td>
  </tr>
  <tr>
    <th>15:00~16:00</th>
     <td><%= number_to_percentage(@call_called_15 / @call_total_15.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_called_b15 / @call_total_b15.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_absence_15 / @call_total_15.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_absence_b15 / @call_total_b15.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_prospect_15 / @call_total_15.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_prospect_b15 / @call_total_b15.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_app_15 / @call_total_15.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_app_b15 / @call_total_b15.to_f * 100, precision: 1) %>）</td>
     <td><%= number_to_percentage(@call_ng_15 / @call_total_15.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_ng_b15 / @call_total_b15.to_f * 100, precision: 1) %>）</td>
  </tr>
  <tr>
    <th>16:00~17:00</th>
    <td><%= number_to_percentage(@call_called_16 / @call_total_16.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_called_b16 / @call_total_b16.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_absence_16 / @call_total_16.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_absence_b16 / @call_total_b16.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_prospect_16 / @call_total_16.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_prospect_b16 / @call_total_b16.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_app_16 / @call_total_16.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_app_b16 / @call_total_b16.to_f * 100, precision: 1) %>）</td>
   <td><%= number_to_percentage(@call_ng_16 / @call_total_16.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_ng_b16 / @call_total_b16.to_f * 100, precision: 1) %>）</td>
  </tr>
  <tr>
    <th>17:00~18:00</th>
    <td><%= number_to_percentage(@call_called_17 / @call_total_17.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_called_b17 / @call_total_b17.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_absence_17 / @call_total_17.to_f * 100, precision: 1) %>
      （<%= number_to_percentage(@call_absence_b17 / @call_total_b17.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_prospect_17 / @call_total_17.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_prospect_b17 / @call_total_b17.to_f * 100, precision: 1) %>）</td>
    <td><%= number_to_percentage(@call_app_17 / @call_total_17.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_app_b17 / @call_total_b17.to_f * 100, precision: 1) %>）</td>
     <td><%= number_to_percentage(@call_ng_17 / @call_total_17.to_f * 100, precision: 1) %>
    　（<%= number_to_percentage(@call_ng_b17 / @call_total_b17.to_f * 100, precision: 1) %>）</td>
  </tr>
</table>
<br>
<br>
<br>
<br>
<table class="header-table space" width="90%">
  <tr>
    <th colspan="11">スタッフ&シェアフル時間別コール</th>
  </tr>
  <tr>
    <th></th>
    <th>09:00~</th>
    <th>10:00~</th>
    <th>11:00~</th>
    <th>13:00~</th>
    <th>14:00~</th>
    <th>15:00~</th>
    <th>16:00~</th>
  </tr>
  <% @users.each do |user| %>
  <tr>
    <th><%= user.user_name %></th>
    <td><%= user.calls.where('time(created_at) >= ? and time(created_at) < ?', '09:00:00','09:59:59').where('created_at > ?', Time.current.beginning_of_day).where('created_at < ?', Time.current.end_of_day).count %></td>
    <td><%= user.calls.where('time(created_at) >= ? and time(created_at) < ?', '10:00:00','10:59:59').where('created_at > ?', Time.current.beginning_of_day).where('created_at < ?', Time.current.end_of_day).count %></td>
    <td><%= user.calls.where('time(created_at) >= ? and time(created_at) < ?', '11:00:00','11:59:59').where('created_at > ?', Time.current.beginning_of_day).where('created_at < ?', Time.current.end_of_day).count %></td>
    <td><%= user.calls.where('time(created_at) >= ? and time(created_at) < ?', '13:00:00','13:59:59').where('created_at > ?', Time.current.beginning_of_day).where('created_at < ?', Time.current.end_of_day).count %></td>
    <td><%= user.calls.where('time(created_at) >= ? and time(created_at) < ?', '14:00:00','14:59:59').where('created_at > ?', Time.current.beginning_of_day).where('created_at < ?', Time.current.end_of_day).count %></td>
    <td><%= user.calls.where('time(created_at) >= ? and time(created_at) < ?', '15:00:00','15:59:59').where('created_at > ?', Time.current.beginning_of_day).where('created_at < ?', Time.current.end_of_day).count %></td>
    <td><%= user.calls.where('time(created_at) >= ? and time(created_at) < ?', '16:00:00','16:59:59').where('created_at > ?', Time.current.beginning_of_day).where('created_at < ?', Time.current.end_of_day).count %></td>
  </tr>
  <% end %>
</table>

<%= form_tag call_import_customers_path, multipart: true do %>
   <table width="90%" class="space">
     <tbody>
        <tr>
           <th colspan="3">CALL_CSVファイルインポート</th>
        </tr>
        <tr>
           <td><%= file_field_tag :call_file %></td>
           <th><%= submit_tag "インポート",  class: 'btn btn-success' %></th>
           <th><%= link_to 'エクスポート', analytics_path(format: :csv), class: 'btn btn-success' %></th>
        </tr>
    </tbody>
   </table>
<% end %>
